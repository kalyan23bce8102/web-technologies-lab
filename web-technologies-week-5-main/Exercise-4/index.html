<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Inventory System (JSON)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 15px;
      background: #f8fafc;
    }
    h1, h2 { color: #1e293b; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #e2e8f0;
      color: #334155;
      font-weight: 600;
    }
    .low-stock {
      background-color: #fef3c7;
      color: #92400e;
      font-weight: 600;
    }
    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin: 25px 0;
      border: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .message {
      min-height: 24px;
      font-weight: 500;
      margin: 10px 0;
    }
    .success { color: #15803d; }
    .error   { color: #b91c1c; }
    button {
      padding: 8px 16px;
      margin: 6px 4px 6px 0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    button.primary   { background: #3b82f6; color: white; }
    button.primary:hover   { background: #2563eb; }
    button.warning  { background: #f59e0b; color: white; }
    button.danger   { background: #ef4444; color: white; }
    button.danger:hover { background: #dc2626; }
    input, select {
      padding: 9px 12px;
      margin: 6px 0;
      width: 240px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      box-sizing: border-box;
    }
    label {
      display: inline-block;
      width: 120px;
      margin: 6px 0;
      color: #475569;
    }
    #summary {
      font-size: 1.1em;
      font-weight: 600;
      margin: 16px 0;
      padding: 12px;
      background: #eff6ff;
      border-radius: 6px;
      border-left: 4px solid #3b82f6;
    }
    .search-container {
      margin: 16px 0;
    }
  </style>
</head>
<body>

<h1>Product Inventory System</h1>

<div class="section">
  <h2>Inventory Overview</h2>
  <div id="summary">Total Inventory Value: — | Total Products: —</div>

  <div class="search-container">
    <label>Filter by Category:</label>
    <input type="text" id="categoryFilter" placeholder="e.g. Electronics, Clothing..." />
    <button class="primary" onclick="renderProducts()">Apply Filter</button>
    <button onclick="clearFilter()">Show All</button>
  </div>

  <table id="inventoryTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Category</th>
        <th>Price (₹)</th>
        <th>Stock</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="productBody"></tbody>
  </table>

  <div id="listMsg" class="message"></div>
</div>

<div class="section">
  <h2>Add New Product</h2>
  <div>
    <label>Product ID:</label>
    <input type="text" id="addId" placeholder="P001" required />
  </div>
  <div>
    <label>Name:</label>
    <input type="text" id="addName" required />
  </div>
  <div>
    <label>Category:</label>
    <input type="text" id="addCategory" required />
  </div>
  <div>
    <label>Price (₹):</label>
    <input type="number" id="addPrice" min="1" step="0.01" required />
  </div>
  <div>
    <label>Stock:</label>
    <input type="number" id="addStock" min="0" required />
  </div>
  <button class="primary" onclick="addProduct()">Add Product</button>
  <div id="addMsg" class="message"></div>
</div>

<div class="section">
  <h2>Edit / Delete Product</h2>
  <div>
    <label>Product ID:</label>
    <input type="text" id="editId" placeholder="Enter ID to edit/delete" required />
  </div>
  <div>
    <label>New Price (₹):</label>
    <input type="number" id="editPrice" min="1" step="0.01" placeholder="optional" />
  </div>
  <div>
    <label>New Stock:</label>
    <input type="number" id="editStock" min="0" placeholder="optional" />
  </div>
  <button class="primary" onclick="updateProduct()">Update</button>
  <button class="danger" onclick="deleteProduct()">Delete</button>
  <div id="actionMsg" class="message"></div>
</div>

<div class="section">
  <button class="primary" onclick="downloadUpdatedJson()">Download updated inventory.json</button>
  <div id="saveMsg" class="message"></div>
</div>

<script>
let products = [];

async function loadInventory() {
  try {
    const res = await fetch("inventory.json");
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    products = await res.json();

    if (!Array.isArray(products)) {
      throw new Error("Expected array of products");
    }

    renderProducts();
    updateSummary();
    showMessage("listMsg", `Loaded ${products.length} products`, "success");

  } catch (err) {
    console.error(err);
    showMessage("listMsg", `Error loading inventory: ${err.message}`, "error");
  }
}

function renderProducts() {
  const tbody = document.getElementById("productBody");
  tbody.innerHTML = "";

  const filterCat = document.getElementById("categoryFilter").value.trim().toLowerCase();

  const filtered = filterCat
    ? products.filter(p => p.category.toLowerCase().includes(filterCat))
    : products;

  if (filtered.length === 0) {
    showMessage("listMsg", filterCat ? "No products match this category" : "No products found", "error");
    updateSummary(filtered);
    return;
  }

  showMessage("listMsg", `Showing ${filtered.length} product(s)`, "success");

  filtered.forEach(p => {
    const row = document.createElement("tr");
    const isLow = p.stock <= 5 && p.stock > 0;
    if (isLow) row.className = "low-stock";

    row.innerHTML = `
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>₹${Number(p.price).toFixed(2)}</td>
      <td>${p.stock}${isLow ? ' <small>(Low Stock!)</small>' : ''}</td>
      <td>
        <button class="warning" onclick="fillEditForm('${p.id}')">Edit</button>
      </td>
    `;
    tbody.appendChild(row);
  });

  updateSummary(filtered);
}

function updateSummary(data = products) {
  if (data.length === 0) {
    document.getElementById("summary").textContent = "Total Inventory Value: ₹0.00 | Total Products: 0";
    return;
  }

  const totalValue = data.reduce((sum, p) => sum + (Number(p.price) * p.stock), 0);
  document.getElementById("summary").textContent =
    `Total Inventory Value: ₹${totalValue.toFixed(2)} | Total Products: ${data.length}`;
}

function addProduct() {
  const id      = document.getElementById("addId").value.trim();
  const name    = document.getElementById("addName").value.trim();
  const cat     = document.getElementById("addCategory").value.trim();
  const price   = document.getElementById("addPrice").value.trim();
  const stock   = document.getElementById("addStock").value.trim();

  if (!id || !name || !cat || !price || !stock) {
    showMessage("addMsg", "All fields are required", "error");
    return;
  }

  const priceNum = Number(price);
  const stockNum = Number(stock);

  if (isNaN(priceNum) || priceNum <= 0) {
    showMessage("addMsg", "Price must be a positive number", "error");
    return;
  }
  if (isNaN(stockNum) || stockNum < 0) {
    showMessage("addMsg", "Stock cannot be negative", "error");
    return;
  }

  if (products.some(p => p.id === id)) {
    showMessage("addMsg", `Product ID ${id} already exists`, "error");
    return;
  }

  products.push({
    id,
    name,
    category: cat,
    price: priceNum,
    stock: stockNum
  });

  renderProducts();
  showMessage("addMsg", `Product ${name} (${id}) added`, "success");
  clearAddForm();
}

function updateProduct() {
  const id = document.getElementById("editId").value.trim();
  if (!id) return showMessage("actionMsg", "Enter Product ID", "error");

  const product = products.find(p => p.id === id);
  if (!product) return showMessage("actionMsg", `Product ${id} not found`, "error");

  const newPrice = document.getElementById("editPrice").value.trim();
  const newStock = document.getElementById("editStock").value.trim();

  let changed = false;

  if (newPrice !== "") {
    const val = Number(newPrice);
    if (isNaN(val) || val <= 0) return showMessage("actionMsg", "Invalid price", "error");
    product.price = val;
    changed = true;
  }

  if (newStock !== "") {
    const val = Number(newStock);
    if (isNaN(val) || val < 0) return showMessage("actionMsg", "Invalid stock quantity", "error");
    product.stock = val;
    changed = true;
  }

  if (!changed) return showMessage("actionMsg", "No changes entered", "error");

  renderProducts();
  showMessage("actionMsg", `Product ${id} updated`, "success");
}

function deleteProduct() {
  const id = document.getElementById("editId").value.trim();
  if (!id) return showMessage("actionMsg", "Enter Product ID", "error");

  const idx = products.findIndex(p => p.id === id);
  if (idx === -1) return showMessage("actionMsg", `Product ${id} not found`, "error");

  if (!confirm(`Delete product ${products[idx].name} (${id})?`)) return;

  products.splice(idx, 1);
  renderProducts();
  showMessage("actionMsg", `Product ${id} deleted`, "success");
  document.getElementById("editId").value = "";
}

function fillEditForm(id) {
  document.getElementById("editId").value = id;
  document.getElementById("editPrice").value = "";
  document.getElementById("editStock").value = "";
}

function clearAddForm() {
  document.getElementById("addId").value = "";
  document.getElementById("addName").value = "";
  document.getElementById("addCategory").value = "";
  document.getElementById("addPrice").value = "";
  document.getElementById("addStock").value = "";
}

function clearFilter() {
  document.getElementById("categoryFilter").value = "";
  renderProducts();
}

function downloadUpdatedJson() {
  if (products.length === 0) return showMessage("saveMsg", "No data to save", "error");

  const json = JSON.stringify(products, null, 2);
  const blob = new Blob([json], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "inventory_updated.json";
  a.click();
  URL.revokeObjectURL(url);

  showMessage("saveMsg", "Updated inventory downloaded", "success");
}

function showMessage(id, text, cls) {
  const el = document.getElementById(id);
  el.textContent = text;
  el.className = "message " + cls;
}

window.addEventListener("load", loadInventory);
</script>

</body>
</html>
